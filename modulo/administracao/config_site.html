{% extends "base.html" %}

{% block title %}Administra√ß√£o - {{ site_config.nome_restaurante }}{% endblock %}

{% block head %}
<style>
  .admin-container {
    max-width: 1100px;
    margin: 2rem auto;
  }
  .card {
    border-radius: 12px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.08);
  }
  .card-header {
    background: #ff5722;
    color: #fff;
    font-weight: bold;
    border-radius: 12px 12px 0 0 !important;
  }
  .form-label { font-weight: 600; }
  .table th { background: #f5f5f5; }
  .flash-container .alert { border-radius: 10px; }
</style>
{% endblock %}

{% block content %}
<div class="admin-container">
  <h2 class="text-center mb-4 text-primary fw-bold"><i class="bi bi-gear"></i> Painel de Administra√ß√£o</h2>

  <!-- FLASH MESSAGES -->
  <div class="flash-container mb-3">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ 'danger' if category=='error' else category }} alert-dismissible fade show" role="alert">
            {% if category == 'success' %}<i class="bi bi-check-circle-fill me-2"></i>{% endif %}
            {% if category in ['danger','error'] %}<i class="bi bi-x-circle-fill me-2"></i>{% endif %}
            {% if category == 'warning' %}<i class="bi bi-exclamation-triangle-fill me-2"></i>{% endif %}
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}
  </div>

  <!-- Abas -->
  <ul class="nav nav-tabs mb-3" role="tablist">
    <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#site">‚öôÔ∏è Configura√ß√µes do Site</a></li>
    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#users">üë§ Usu√°rios</a></li>
  </ul>

  <div class="tab-content">
    <!-- Aba Config Site -->
    <div class="tab-pane fade show active" id="site">
      <div class="card">
        <div class="card-header"><i class="bi bi-building"></i> Configura√ß√µes do Site</div>
        <div class="card-body">
          <form method="POST">
            <input type="hidden" name="form_type" value="site">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">Nome do Restaurante</label>
                <input type="text" name="nome_restaurante" class="form-control" value="{{ site_config.nome_restaurante }}">
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Logo (URL)</label>
                <input type="text" name="logo_url" class="form-control" value="{{ site_config.logo_url }}">
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">Banner (URL)</label>
              <input type="text" name="banner_url" class="form-control" value="{{ site_config.banner_url }}">
            </div>
            <div class="row">
              <div class="col-md-4 mb-3">
                <label class="form-label"><i class="bi bi-instagram"></i> Instagram</label>
                <input type="text" name="instagram" class="form-control" value="{{ site_config.instagram }}">
              </div>
              <div class="col-md-4 mb-3">
                <label class="form-label"><i class="bi bi-facebook"></i> Facebook</label>
                <input type="text" name="facebook" class="form-control" value="{{ site_config.facebook }}">
              </div>
              <div class="col-md-4 mb-3">
                <label class="form-label"><i class="bi bi-whatsapp"></i> WhatsApp</label>
                <input type="text" name="whatsapp" class="form-control" value="{{ site_config.whatsapp }}">
              </div>
            </div>
            <div class="text-end">
              <button type="submit" class="btn btn-warning"><i class="bi bi-save"></i> Salvar Configura√ß√µes</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Aba Usu√°rios -->
    <div class="tab-pane fade" id="users">
      <div class="card">
        <div class="card-header"><i class="bi bi-people"></i> Usu√°rios Registrados</div>
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0">Lista de Usu√°rios</h5>
            <button class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#modalAddUser">
              <i class="bi bi-person-plus"></i> Novo Usu√°rio
            </button>
          </div>

          <table class="table table-hover align-middle">
            <thead>
              <tr>
                <th>ID</th><th>Nome</th><th>Email</th><th>Fun√ß√£o</th><th class="text-end">A√ß√µes</th>
              </tr>
            </thead>
            <tbody>
              {% for u in usuarios %}
              <tr>
                <td>{{ u.id }}</td>
                <td>{{ u.nome }}</td>
                <td>{{ u.email }}</td>
                <td>
                  {% if u.role == "admin" %}
                    <span class="badge bg-danger"><i class="bi bi-shield-lock"></i> Admin</span>
                  {% else %}
                    <span class="badge bg-secondary"><i class="bi bi-person"></i> Cliente</span>
                  {% endif %}
                </td>
                <td class="text-end">
                  <!-- Bot√£o Editar -->
                  <button class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#modalEditUser{{ u.id }}">
                    <i class="bi bi-pencil"></i>
                  </button>
                  <!-- Bot√£o Excluir -->
                  <button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#modalDeleteUser{{ u.id }}">
                    <i class="bi bi-trash"></i>
                  </button>
                </td>
              </tr>

              <!-- Modal Editar -->
              <div class="modal fade" id="modalEditUser{{ u.id }}" tabindex="-1">
                <div class="modal-dialog">
                  <form method="POST" action="{{ url_for('administracao.edit_user', user_id=u.id) }}" class="modal-content">
                    <div class="modal-header bg-warning">
                      <h5 class="modal-title"><i class="bi bi-pencil"></i> Editar Usu√°rio</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                      <div class="mb-3"><label class="form-label">Nome</label><input type="text" name="nome" class="form-control" value="{{ u.nome }}"></div>
                      <div class="mb-3"><label class="form-label">Email</label><input type="email" name="email" class="form-control" value="{{ u.email }}"></div>
                      <div class="mb-3">
                        <label class="form-label">Fun√ß√£o</label>
                        <select name="role" class="form-select">
                          <option value="cliente" {% if u.role=="cliente" %}selected{% endif %}>Cliente</option>
                          <option value="admin" {% if u.role=="admin" %}selected{% endif %}>Administrador</option>
                        </select>
                      </div>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                      <button type="submit" class="btn btn-warning">Salvar</button>
                    </div>
                  </form>
                </div>
              </div>

              <!-- Modal Excluir -->
              <div class="modal fade" id="modalDeleteUser{{ u.id }}" tabindex="-1">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header bg-danger text-white">
                      <h5 class="modal-title"><i class="bi bi-trash"></i> Excluir Usu√°rio</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                      Tem certeza que deseja excluir o usu√°rio <b>{{ u.nome }}</b>?
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                      <a href="{{ url_for('administracao.delete_user', user_id=u.id) }}" class="btn btn-danger">Excluir</a>
                    </div>
                  </div>
                </div>
              </div>

              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Adicionar Usu√°rio -->
<div class="modal fade" id="modalAddUser" tabindex="-1">
  <div class="modal-dialog">
    <form method="POST" action="{{ url_for('administracao.update_config_site') }}" class="modal-content">
      <input type="hidden" name="form_type" value="user">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title"><i class="bi bi-person-plus"></i> Novo Usu√°rio</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3"><label class="form-label">Nome</label><input type="text" name="nome" class="form-control"></div>
        <div class="mb-3"><label class="form-label">Email</label><input type="email" name="email" class="form-control"></div>
        <div class="mb-3"><label class="form-label">Senha</label><input type="password" name="senha" class="form-control"></div>
        <div class="mb-3">
          <label class="form-label">Fun√ß√£o</label>
          <select name="role" class="form-select">
            <option value="cliente">Cliente</option>
            <option value="admin">Administrador</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="submit" class="btn btn-success">Criar</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}
